# Excel自动化处理工作流项目规则

## 项目概述

本项目是一个Excel自动化处理工作流，用于处理和合并多个Excel文件中的数据。整个工作流分为三个阶段：

1. **第一阶段**：处理单个Excel文件，将原始数据处理后写入目标Excel文件的对应sheet中
2. **第二阶段**：批量处理多个Excel文件，将处理结果保存到输出目录中
3. **第三阶段**：合并第二阶段处理后的多个Excel文件，将所有文件的相同sheet合并到一个最终的Excel文件中

## 目录结构

```
ZRExcelWorkflow/
├── data/                # 数据目录
│   ├── input/           # 存放原始数据文件
│   ├── output/          # 存放第二阶段处理后的文件
│   └── final/           # 存放最终合并结果
├── scripts/             # 脚本目录
│   ├── phase1/          # 第一阶段：处理单个Excel文件的脚本
│   ├── phase2/          # 第二阶段：批量处理多个Excel文件的脚本
│   └── phase3/          # 第三阶段：合并处理结果的脚本
├── utils/               # 工具函数模块
├── main.py              # 主程序入口
├── PROJECT_RULES.md     # 项目规则文档（本文件）
└── README.md            # 项目说明文档
```

## 代码规范

### 1. 命名规范

- **文件名**：使用小写字母和下划线，如 `process_sheet1_attendance.py`
- **函数名**：使用小写字母和下划线，如 `process_single_file()`
- **变量名**：使用小写字母和下划线，如 `input_dir`
- **常量名**：使用大写字母和下划线，如 `MAX_WORKERS`

### 2. 注释规范

- 每个文件顶部必须包含文件说明注释
- 每个函数必须包含函数说明注释，包括功能、参数和返回值
- 复杂的代码逻辑必须添加行内注释

### 3. 代码风格

- 遵循PEP 8规范
- 缩进使用4个空格
- 行长度不超过100个字符
- 函数之间空两行，类方法之间空一行

### 4. 错误处理

- 使用 try-except 结构处理可能的异常
- 记录详细的错误信息，包括错误类型和发生位置
- 对于关键操作，必须进行错误恢复

### 5. 日志记录

- 使用 logging 模块记录日志
- 日志级别：DEBUG、INFO、WARNING、ERROR、CRITICAL
- 日志内容应包含时间、级别、模块名和详细信息

## 开发流程

### 1. 功能开发

1. 分析需求，确定功能点
2. 设计实现方案
3. 编写代码和单元测试
4. 进行功能测试
5. 代码审查
6. 合并到主分支

### 2. 版本控制

- 使用Git进行版本控制
- 主分支：master/main
- 开发分支：dev
- 功能分支：feature/xxx
- 修复分支：bugfix/xxx

### 3. 发布流程

1. 从开发分支创建发布分支：release/vX.Y.Z
2. 进行发布测试
3. 修复发布分支中的问题
4. 合并到主分支和开发分支
5. 在主分支上打标签：vX.Y.Z

## 使用指南

### 1. 环境配置

- Python 3.7+
- 依赖包：pandas, openpyxl, numpy

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 数据准备

1. 将原始数据文件放入 `data/input` 目录
2. 确保原始数据文件格式正确，包含必要的sheet

### 4. 运行工作流

#### 运行整个工作流

```bash
python main.py
```

#### 运行特定阶段

```bash
python main.py --phase 1  # 运行第一阶段
python main.py --phase 2  # 运行第二阶段
python main.py --phase 3  # 运行第三阶段
```

#### 运行特定sheet的处理

```bash
python main.py --phase 1 --sheet sheet1  # 处理第一个sheet
```

### 5. 结果查看

- 第一阶段结果：`data/output/测试合并.xlsx`
- 第二阶段结果：`data/output/` 目录下的所有处理后文件
- 第三阶段结果：`data/final/merged_results.xlsx`

## 维护与更新

### 1. 添加新的sheet处理

1. 在 `scripts/phase1` 目录下创建新的处理脚本
2. 在 `scripts/phase2/batch_process.py` 中添加新的处理函数
3. 在 `scripts/phase3/merge_results.py` 中更新 `get_sheet_names()` 函数

### 2. 修改现有sheet处理

1. 修改 `scripts/phase1` 目录下对应的处理脚本
2. 测试修改后的功能

### 3. 优化性能

- 对于大数据量处理，考虑使用分块读取和处理
- 优化内存使用，避免一次性加载过多数据
- 使用并行处理提高处理速度

## 常见问题解答

### 1. 数据格式问题

**问题**：原始数据文件格式不正确，导致处理失败

**解决方案**：
- 检查原始数据文件是否包含必要的sheet
- 检查sheet中的列名是否符合预期
- 修改处理脚本，适应不同的数据格式

### 2. 内存溢出问题

**问题**：处理大文件时出现内存溢出

**解决方案**：
- 使用分块读取和处理
- 减少一次性加载的数据量
- 增加系统内存或使用更高配置的机器

### 3. 处理速度慢问题

**问题**：处理大量文件时速度很慢

**解决方案**：
- 使用并行处理
- 优化处理算法
- 减少不必要的数据读写操作

## 联系与支持

如有问题或需要支持，请联系项目负责人。

---

*最后更新时间：2024-05-24*